# 技术架构文档
# Prompt Hub: AI 提示词共享平台

## 系统概述

Prompt Hub 使用 React、TypeScript 和 Supabase 构建的现代 Web 应用程序。架构遵循客户端-服务器模型，前端处理 UI 渲染和状态管理，而 Supabase 提供包括身份验证、数据库和存储在内的后端服务。

## 架构图

```
┌─────────────────────────────────────┐
│            客户端 (浏览器)          │
│                                     │
│  ┌─────────────┐    ┌────────────┐  │
│  │   React UI  │    │  TanStack  │  │
│  │   组件      │◄───┤   Query    │  │
│  └─────────────┘    └────────────┘  │
│          │                 ▲        │
│          ▼                 │        │
│  ┌─────────────────────────────┐    │
│  │         React Router        │    │
│  └─────────────────────────────┘    │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│         Supabase 服务               │
│                                     │
│  ┌─────────────┐  ┌───────────────┐ │
│  │    认证     │  │    数据库     │ │
│  └─────────────┘  └───────────────┘ │
│  ┌─────────────┐  ┌───────────────┐ │
│  │    存储     │  │   Edge 函数   │ │
│  └─────────────┘  └───────────────┘ │
└─────────────────────────────────────┘
```

## 组件结构

### 前端架构

前端遵循基于组件的架构，包含以下关键元素：

1. **页面**: 代表整个屏幕的顶层组件
   - Home/Index
   - PromptDetail
   - SubmitPrompt
   - Profile
   - Categories
   - 认证页面

2. **组件**: 可重用的 UI 元素
   - 布局组件（Navbar、Footer）
   - 提示词相关组件（PromptCard、PromptForm、PromptStats）
   - UI 组件（按钮、输入框、模态框）
   
3. **Hooks**: 共享逻辑的自定义 hooks
   - `useAuth`: 认证状态和功能
   - `usePromptForm`: 提示词表单处理
   - `usePublicPrompts`: 公共提示词数据获取
   - `usePromptActions`: 提示词操作（标星、复制等）

4. **Contexts**: 跨组件共享状态
   - `AuthContext`: 用户认证状态

5. **Utils**: 工具函数和辅助工具

### 数据库架构

核心数据库表及其关系：

```
┌────────────┐     ┌──────────────┐     ┌──────────────┐
│  profiles  │     │    prompts   │     │shared_prompts│
├────────────┤     ├──────────────┤     ├──────────────┤
│ id         │◄────┤ user_id      │     │ id           │
│ username   │     │ id           │◄────┤ prompt_id    │
│ avatar_url │     │ title        │     │ shared_by    │
└────────────┘     │ description  │     │ shared_with  │
                   │ content      │     └──────────────┘
                   │ category     │
                   │ tags         │
                   │ is_public    │
                   │ share_count  │
                   └──────────────┘
```

## 数据流

1. **用户认证流程**:
   - 用户通过 Supabase Auth 注册/登录
   - 认证状态存储在 AuthContext
   - 受保护路由检查认证状态后渲染

2. **提示词创建流程**:
   - 用户填写 PromptForm 组件
   - 表单数据通过 React Hook Form 验证
   - 提交后数据发送到 Supabase 数据库
   - UI 通过 TanStack Query 缓存更新

3. **提示词发现流程**:
   - FeaturedPrompts 组件通过 usePublicPrompts hook 获取数据
   - 数据在 PromptCard 组件中展示
   - 分页/过滤通过查询参数处理

4. **社交互动流程**:
   - 标星/复制/分享操作触发数据库更新
   - 计数器在 UI 中乐观更新
   - 后台重新获取确保数据一致性

## 安全考虑

1. **认证**: Supabase Auth 处理 JWT 令牌
2. **授权**: Supabase 中的行级安全性（RLS）策略
3. **数据验证**: 客户端和服务器端验证
4. **API 安全**: Supabase 处理 SQL 注入保护

## 性能优化

1. **数据获取**: TanStack Query 用于缓存和后台重新获取
2. **代码分割**: React Router 用于基于路由的代码分割
3. **资源优化**: 图片压缩和懒加载
4. **状态管理**: 最小化不必要的重新渲染

## 开发工作流

1. **环境**: Vite 用于快速开发和构建
2. **类型安全**: TypeScript 增强开发体验
3. **样式**: Tailwind CSS 用于实用优先的样式
4. **组件**: shadcn/ui 用于一致的设计系统

## 部署策略

1. **托管**: 通过 Lovable 的发布功能部署
2. **CI/CD**: 代码更改自动部署
3. **自定义域名**: 支持连接自定义域名

## 监控和分析

1. **错误追踪**: 开发时的控制台日志记录
2. **性能监控**: 计划用于未来阶段
3. **使用分析**: 计划用于未来阶段

## 未来技术考虑

1. **扩展**: 随内容增长计划数据库分片
2. **实时功能**: 考虑使用 Supabase Realtime 实现协作功能
3. **API 开发**: 用于与 AI 工具集成的外部 API
4. **移动应用**: 考虑使用 React Native 实现原生移动体验
